# class Solution(object):
#     def maximalRectangle(self, matrix):
#         """
#         :type matrix: List[List[str]]
#         :rtype: int
#         """
#         if matrix == [[]]:
#             return 0
#         m, n = len(matrix), len(matrix[0])
#         res = 0

#         dp = [[(0,0) for i in xrange(n)] for j in xrange(m)]
#         dp[0][0] = (1, 1) if matrix[0][0] == 1 else (0, 0)
#         res = dp[0][0][0]
#         for i in xrange(1, m):
#             if matrix[i][0] == 1:
#                 dp[i][0] = (dp[i-1][0][0]+1, 1)
#                 res = max(dp[i][0][0], res)
#             else:
#                 dp[i][0] = (0,0)

#         for i in xrange(1, n):
#             if matrix[0][i] == 1:
#                 dp[0][i] = (1, dp[0][j-1][1]+1)
#                 res = max(dp[0][i][1], res)
#             else:
#                 dp[0][i] = (0,0)


#         for i in xrange(1, m):
#             for j in xrange(1, n):
#                 if matrix[i][j] == 1:
#                     rx, ry = dp[i-1][j][1], dp[i][j-1][0]
#                     sx, sy = i-1-(rx-1), j-1-(ry-1)
#                     # print "sx %d, i %d, m %d" % (sx, i, j)
#                     # print "sy %d, j %d, n %d" % (sy, j, n)
#                     can_right = all(x == 1 for bk in matrix[sx:i][j:j+1] for x in bk )
#                     can_down = all(x == 1 for bk in matrix[i:i+1][sy:j] for x in bk )

#                     if can_right:
#                         ry += 1
#                     else:
#                         ry = 1
#                     if can_down:
#                         rx += 1
#                     else:
#                         rx = 1
#                     dp[i][j] = (rx, ry)
#                     print "(%d, %d) achieve (rx, ry) = (%d, %d), right %s, down %s, dp_left %s, dp_up %s" % (i, j, rx, ry, str(can_right), str(can_down), str(dp[i][j-1]), str(dp[i-1][j]))
#                     res = max(res, rx * ry)
#         print dp
#         return res

# class Solution(object):
#     def maximalRectangle(self, matrix):
#         """
#         :type matrix: List[List[str]]
#         :rtype: int
#         """
#         if matrix == [[]]:
#             return 0
#         m, n = len(matrix), len(matrix[0])
#         res = 0

#         dp = [[(0,0) for i in xrange(n)] for j in xrange(m)]
#         dp[0][0] = (1, 1) if matrix[0][0] == 1 else (0, 0)
#         res = dp[0][0][0]
#         for i in xrange(1, m):
#             if matrix[i][0] == 1:
#                 dp[i][0] = (dp[i-1][0][0]+1, 1)
#                 res = max(dp[i][0][0], res)
#             else:
#                 dp[i][0] = (0,0)

#         for i in xrange(1, n):
#             if matrix[0][i] == 1:
#                 dp[0][i] = (1, dp[0][j-1][1]+1)
#                 res = max(dp[0][i][1], res)
#             else:
#                 dp[0][i] = (0,0)


#         for i in xrange(1, m):
#             for j in xrange(1, n):
#                 if matrix[i][j] == 1:
#                     can_right = all(x == 1 for bk in matrix[0:i][j:j+1] for x in bk )
#                     can_down = all(x == 1 for bk in matrix[i:i+1][0:j] for x in bk )

#                     rx, ry = dp[i-1][j][1], dp[i][j-1][0]
#                     if can_right:
#                         ry += 1
#                     else:
#                         ry = 1
#                     if can_down:
#                         rx += 1
#                     else:
#                         rx = 1
#                     dp[i][j] = (rx, ry)
#                     print "(%d, %d) achieve (rx, ry) = (%d, %d), right %s, down %s, dp_left %s, dp_up %s" % (i, j, rx, ry, str(can_right), str(can_down), str(dp[i][j-1]), str(dp[i-1][j]))
#                     res = max(res, rx * ry)
#         return res


class Solution(object):
    def maximalRectangle(self, matrix):
        """
        :type matrix: List[List[str]]
        :rtype: int
        """
        if matrix == [[]] or matrix == [] or matrix == [""]:
            return 0
        m = len(matrix)
        if m < 1:
            return 0
        n = len(matrix[0])
        res = 0

        # matrix = [[0 for i in xrange(n)] for j in xrange(m)]

        for i in xrange(m):
            for j in xrange(n):
                if matrix[i][j] == '0':
                    matrix[i][j] = 0
                elif matrix[i][j] == '1':
                    matrix[i][j] = 1
                else:
                    matrix[i][j] = matrix[i][j]


        dp = [[(0,0) for i in xrange(n)] for j in xrange(m)]
        dp[0][0] = (1, 1) if matrix[0][0] == 1 else (0, 0)
        res = dp[0][0][0]
        for i in xrange(1, m):
            if matrix[i][0] == 1:
                dp[i][0] = (dp[i-1][0][0]+1, 1)
                res = max(dp[i][0][0], res)
            else:
                dp[i][0] = (0,0)

        for i in xrange(1, n):
            if matrix[0][i] == 1:
                dp[0][i] = (1, dp[0][i-1][1]+1)
                res = max(dp[0][i][1], res)
            else:
                dp[0][i] = (0,0)


        for i in xrange(1, m):
            for j in xrange(1, n):
                if matrix[i][j] == 1:
                    # print "===================="
                    # print "(i,j) = (%d,%d)" % (i,j)
                    dp[i][j] = (1, 1)
                    xx, yy = i, j
                    while xx >= 0 and matrix[xx][j] != 0:
                        xx -= 1
                    while yy >= 0 and matrix[i][yy] != 0:
                        yy -= 1
                    if matrix[i-1][j-1] != 0:
                        rx, ry = dp[i-1][j-1][0], dp[i-1][j-1][1]

                        # print i,j, rx, ry, colx, coly, rowx, rowy
                        tx, ty = max((i-1)-(rx-1), xx+1), max((j-1)-(ry-1), yy+1)
                        # print tx, ty
                        dp[i][j] = (i-tx+1, j-ty+1)

                    if matrix[i-1][j] != 0:
                        temp = (i-xx, 1)
                        if temp[0] * temp[1] > dp[i][j][0] * dp[i][j][1]:
                            dp[i][j] = temp

                    if matrix[i][j-1] != 0:
                        temp = (1, j-yy)
                        if temp[0] * temp[1] > dp[i][j][0] * dp[i][j][1]:
                            dp[i][j] = temp

                    # print "(%d,%d) final is (%d, %d)" % (i,j, dp[i][j][0], dp[i][j][1])
                    res = max(dp[i][j][0] * dp[i][j][1], res)
        # print dp[4][5]
        return res


sln = Solution()
print sln.maximalRectangle([[1]])
m = [[1,0,1,0,0],[1,0,1,1,1],[1,1,1,1,1],[1,0,0,1,0]]
print sln.maximalRectangle(m)
print sln.maximalRectangle([[1],[0],[1]])
print sln.maximalRectangle([[]])
print sln.maximalRectangle([[0,0,1,0],[1,1,1,1],[1,1,1,1],[1,1,1,0],[1,1,0,0],[1,1,1,1],[1,1,1,0]])
print sln.maximalRectangle([[0,0,0,1,0,1,0],[0,1,0,0,0,0,0],[0,1,0,1,0,0,1],[0,0,1,1,0,0,1],[1,1,1,1,1,1,0],[1,0,0,1,0,1,1],[0,1,0,0,1,0,1],[1,1,0,1,1,1,0],[1,0,1,0,1,0,1],[1,1,1,0,0,0,0]])
print sln.maximalRectangle([[0,1,0,0,0],[1,0,0,1,1],[1,0,0,1,1]])
print sln.maximalRectangle([[0,0,0],[0,1,1],[0,1,1]])
# print sln.maximalRectangle(["1111111110111111111101111111111111101011110111111111111111111111111111001011111011111111111111111111","1111111110111111111111111011111110111111111011011111111111111111111111111110111101101111110111111011","1111111111101101111110111111111111111111111011110111111111110111111111111111111111111111111111111001","1111111111111111111111111111111111111110111011110111111111111111111111111111011111111110110111111111","0111111111111101111111111111111111111111111110111110110111111111111111110110111111110111111111111100","1111111111111111111111111101111111111011111101111111111111111111111111011110111111111111111101111111","1101111111111111111111111101111111111111111111111111111111111111011111111111111111111110001111111111","1111111111110111011111111101111011111011111111111111111111111111111111111111101111111111011111111011","1101111111111111111111101111111111101111111111111111111110101101111011111111111111111101111111111111","1111111101111101101111111111111011101111110110111111111111111101011111111111110111111111011111111111","1111111111011101111111111111011111110111111111111111111011111111111111111111111111111111111111111110","1111110101111111111110111111101111111111111111111011111111111111011111101110111110111111111111110111","1011111101111111101111111111111111011111101101111111111111111111111111111111111011111111111111111010","1111011111111111111111111111111111111111111111011111111111111111111111111101111111111111111011111111","1111111111111111111111110111111111111010111111111011110111101111111011111011111111111101111111101111","1111111111110111111111111111111111111111111111111010011111101111111111110111111111111111111111101111","1111111111111111111111100111111111111111111111111111111111111111111111101111111111111111111101111111","1101111111011111011111111111111111111111111111111110111110111101111111111011111111111101101011111111","1111111111111111111111111011111111111111111111111111111111111111111101111111110111111111111111111111","1110111111111111110111111011011111111101110111111111001111111111111011111111101111111111101110111011","1011111111111101101111111011111111110011111111111111111111111110111111111111111111111110111011110111","1110111111111111111111111111111110111111111111111111111111111111011111111111111111111111111111111111","1101111111111010111111110011111111011011111101111111111101101111111111111110111011111111111111111111","1111111101111111011101111111111101111100111111111111111011111111111111111111111101110111101111111111","1111110111111011011111111111111111111111111111111111111111011101111111101101111111101111110111111111","1111111111111101111111111111101011111111111111111111101111011111111111111111111111111111111111110111","1111011111111111110111111111101111011100111111111111101101101110111111111110111111111111111011111111","1111111111111111111111111111110101111101111011111111101111111101111111111111111110111111111111111111","1111111101110011111111111111111111110111111111111111111111111111111111111111111111001111111111111111","0111110111111111111111111111111111111011111011111111111110111011111101011111111111111111111111111111","1111111111111111011111111011111111111111111111111111011111111101111111111111111111111111011011111111","1111111101111111111101111011111111111111111111111111111111111111111011111111110111011111111111111111","1110111111011111101101101011111111110111111111111111101110110100111111111111111111111111111111111101","1111111111111111111111111111111111111111111011111101111111011111111101111101111111111111111101111111","1110111111100111111111111111111111111111011111111111110111110111111111111101111111111111111111111111","1111111111111110111111111111111111110111111101111111110111101111111111111011110111110101101111111111","1111110111111111111111111111111111111111111110011111111111111111111111111111110011011111101111111110","1111111111111111111110101110011111111001111111111101101111111111111111111111111111111111111110111111","1110111111011110111011111111111111111111111111111111111111111010111111111001110111111111011111011111","1011111111111111111111111101111111111111111111111111111111111111111111111111111011111111111111101111","1111111111111111111111111111111101111111111111111110111111111111110111111111111111111001111110111111","1111110111101111111111111111111100111111111111111101011111111111110101111111111111011111111011101111","1110111111111111101111111111111110111111110111110111101111111111111111111111111111101111111111111111","1111111111111111111111011111111111111111111010111111111111111111111110111111111111111111110011111111","1010111111111011111111111111111111111111111111011101111111111111111111101111111111111011111111111101","1111111111011111111111111111111111111111111111111111111111111111111111111111110111111111111111111111","1111111110111111110011011111111110111111111101111110111111111111011111111111101011001111001101111111","1111111111111111111111111011111111111110101111111111111111111111111111111111111111111111111111111111","1111111111110111111111111101011111111111111111111110111111111111110111111111111011111111110111111011","1110111011110011111111011111111111111110111111111111101110111111111111111111111111111111110111111111","0101111111111111110110111111111111111111111111111111101111111111111101101011111111110111111111111111","1011110111011111111111111111111111111111110111110111111001111111111111111111001111111111111111101111","1111110111111111111111111110111111111111111111111111101111111111111111101111111111111011111111011110","1111011111111111111111101110111101111111111111111111111111111111110111111111111111101111111111011111","1111111111111111111111111111111111111111111011111111111111111111111111111110011111111111111111111111","1111111111111111111111111101111101111111111111111110111111111111111111111111111111111111100111111111","0011111111111111111111111111011111111101111111111111111111111111111111111111111111111111111111111111","1111111110111111111111111111111111011111111111111110111111111111111101111111111111111111101111111111","1111111111101111011111111111011110111111011111111101111111111110111111111111111110111011111111110111","1111111111110111111111111111111111111110101111111111111111111111111111111101011111111101101101111011","1111111111111111101111111111101110101110111111111111111111110111111111111111111111101111111111111111","1111111111011111111111111111111101111110111111110111111111111111111111101101111111111111111111111111","0111110111011111111111111101011101100111111011101111011111011111111111111101111110111111111111111011","1111111111110101111111111111111111110111111111111111111110111111101111111111111111111011111111111111","1111101111111011110111111111111111111111101111111111111111111111110111111111011111111111111101111111","1111111101111111111111111111111001111111111011111111111111111011111111111111110011011111111111111111","1111111111111111111111111111111111111111111111011101111111111111101111111101011111111101111111111111","1111101101111111111111111111111111110110011111111111111111111101111110111111111111111111111111111111","1111111111111111111111110111111101111110111011111111101011111011111110111111111111101111111111111111","1111111111101111100111010111111110011111110110111111111011111111111101111111111111111101111111110111","1111111111111111101111111111111111111111111111101111011111111111111111111111111111111101111111111111","1111111101111111111111111111111111110110111111111101101111111111111111111011111111111111111101111011","1101111111111111111111111110110101111111111111111111111111111111111110011101111111100111111111111110","1111111011111111101111110111111111111111111101111111111101101011111011111111111111111111111111111111","1111011111110111111111011111111111011111111111111111111111111111111111111110111111111111011111111111","1111111111111111111111111111111011111111110111111110111111111101111111111111111011011111111111111111","1111111110111111111111111111111110111111111111111111101111111111111111111111111111111101111110100111","1111011111111111110111111111111111110111011111111111110111111111111111011111111111111111111111110111","1011111111111100111101111111111111101111111111111111111111111111111111110011111111111111111111111101","1111111011111111111111110111111111111110111011111111111101111111111111111111111111111111111111111111","1101111111111111111111111111111111111111111111111100011111111110101111111111101111111111111111111111","1111001111111111111111101111111111111111111111111111111111111111111111111111111111110111111111111111","1111111101111111111111111111111011111111111111111111111111111111011111110011111101111111011111111111","1110111111111101111111111101111111111111111111111111111111011111111001110111111011111011111111111111","1111111001111111110111111110111111111111111011111111111111111111111111110111111111111111111111111111","1011111111111111110101101101111111111011111111111111011111110111111011111111111111011111111111111111","1101111111111110110011101111111111101111110111110111111111101111111101110111111111111111100111111111","0111111110111111111111111111111111111111111111111111111111111111111111111111111111101111111111111111","1111111111111110111101111111111111111111111111111111111111011011111111111101101011111111111111111111","1111101111111111111011111111111111111111110111111101111110111111111011111111111111111111111111111111","1111111101111111011111111111110111111111111111111111011110101111011111111011111011011111111111111111","1101111111111111101111111111111111111111011001111111111111111111111111111111111111111111111111111011","1111111111111101111110111111011111111111111111111111111111110111111111111111111111111111111011111111","1111110110111111111111111101111111111111111111111111111111111111111111111111111110011111101111111111","1110111111111111111111111111111111111111111111111111111011111111111111111111111111011111111111111111","1110111101111011110111111101111111111111111111111111111111111111111111111111110111110111111111111111","0011111111110111111111110011111111111101111111101111111111100111001111110111111111111111111111111111","1111111011111111111101111111111111111111111110110111111111111111111111111111111101101111111011111111","1111011111111111101111111111111111111111000111111111111111111011111111111111011111111101011111111111","1111111111111111011111111111111111111111111111111111111111111111111111011111111101110111110111111111"])

# coding: utf8
class Solution(object):
    def minRefuelStopsWA(self, target, startFuel, stations):
        """
        :type target: int
        :type startFuel: int
        :type stations: List[List[int]]
        :rtype: int
        """
        stations.sort()
        n = len(stations)
        current_fuel = startFuel
        current_dist = 0
        if n == 0:
            return 0 if current_fuel >= target else -1
        else:
            current_fuel -= stations[0][0]
            current_dist = stations[0][0]

        # 第i个加油站往后一共有多少油
        have = [0] * (n + 1)
        for i in xrange(n - 1, -1, -1):
            if i == n - 1:
                have[i] = stations[i][1]
            else:
                have[i] = have[i + 1] + stations[i][1]
        max_need = [0] * (n + 1)
        for i in xrange(n, -1, -1):
            if i == n:
                max_need[i] = target - stations[-1][0]
            elif i == 0:
                max_need[i] = max(max_need[i + 1], max_need[i + 1] - stations[i][1] + stations[i][0])
            else:
                max_need[i] = max(max_need[i + 1], max_need[i + 1] - stations[i][1] + stations[i][0] - stations[i - 1][0])

        ans = 0
        for i in xrange(n):
            # 在加油站i到加油站i+1
            nxt = target
            if i != n - 1:
                nxt = stations[i + 1][0]
            # print "i {}, fuel {}, dis {}, nxt {}".format(i, current_fuel, current_dist, nxt)
            if current_fuel < 0:
                return -1
            if current_fuel < nxt - current_dist:
                # print "Stop at", i
                ans += 1
                current_fuel = current_fuel - (nxt - current_dist) + stations[i][1]
                current_dist = nxt
            else:
                if current_fuel < max_need[i]:
                    # print "Stop at", i
                    ans += 1
                    current_fuel += stations[i][1]
                else:
                    current_fuel = current_fuel - (nxt - current_dist)
                    current_dist = nxt

        if current_fuel >= 0:
            return ans
        else:
            return -1

    def minRefuelStops(self, target, startFuel, stations):
        """
        :type target: int
        :type startFuel: int
        :type stations: List[List[int]]
        :rtype: int
        """
        stations.sort()
        n = len(stations)
        # print "N", n + 2

        if n == 0:
            return 0 if startFuel >= target else -1

        pos = 0
        stations = [[0, startFuel]] + stations + [[target, 0]]
        N = n + 2
        dp = [[-1 for j in xrange(N + 1)] for i in xrange(N + 1)]

        dp[0][0] = startFuel

        for i in xrange(1, N):
            for j in xrange(i + 1):
                cost = stations[i][0] - stations[i - 1][0]
                stop = -1
                nostop = -1
                if dp[i - 1][j - 1] - cost >= 0:
                    stop = dp[i - 1][j - 1] + stations[i][1] - cost
                if dp[i - 1][j] - cost >= 0:
                    nostop = dp[i - 1][j] - cost
                dp[i][j] = max(stop, nostop)

        for j in xrange(N):
            if dp[N - 1][j] >= 0:
                # print "dp[{}][{}]={}".format(N-1,j,dp[N-1][j])
                return j
        return -1

sln = Solution()
print sln.minRefuelStops(1, 1, []) # 0
print sln.minRefuelStops(100, 1, [[10, 100]]) # -1
print sln.minRefuelStops(100, 10, [[10,60],[20,30],[30,30],[60,40]]) # 2
print sln.minRefuelStops(100,25,[[25,25],[50,25],[75,25]]) # 3
print sln.minRefuelStops(1000,83,[[47,220],[65,1],[98,113],[126,196],[186,218],[320,205],[686,317],[707,325],[754,104],[781,105]]) # 4

print sln.minRefuelStops(1000000000, 280565345, [[8176497,178771877],[11525458,82092963],[14486875,197502234],[16582082,107189487],[17493777,135852815],[18143259,185299132],[18570731,12910299],[24967914,167699871],[29650836,192645324],[30855334,91300961],[32371017,174339545],[33425385,136688493],[35301830,101918543],[35867039,90252483],[36458501,69480523],[36653559,56223072],[36840294,25688437],[40729514,8868556],[41784795,132981045],[42671092,142763312],[43129000,74194749],[43362978,105381979],[44094779,107997585],[48795317,116719586],[52187314,146601512],[56322620,41430516],[65010754,23246298],[65421762,104754277],[65891621,51913362],[68945648,41123503],[71911542,64700408],[74695358,185278467],[75492662,115948995],[76697536,116868926],[76785550,192813276],[77573032,96478466],[78624233,64144776],[80718685,130720273],[82522364,30252668],[83285511,68584518],[83412087,100036332],[84529619,171510616],[87518046,95506733],[92310900,78007103],[92842296,152302335],[99529652,144403518],[99672084,10134776],[102109540,36826964],[103683276,111130730],[104072842,188506553],[104752178,189374807],[106519152,147781596],[106914669,143115837],[107819420,93365681],[108819985,101069906],[108916954,88623578],[109200307,132284142],[109563362,125540843],[110187303,158584203],[111355932,22082523],[111402127,164493611],[111915007,191395450],[112452922,5024023],[119784121,72891921],[119830324,24709388],[121099611,80619193],[121569606,123072302],[122325564,89391090],[123197577,137869818],[125299827,173537927],[125345166,54689004],[130927423,132063791],[132871135,150253355],[134804973,63386165],[135524575,187053919],[136385479,42130603],[140999476,189388615],[145672555,87826038],[148997200,94283744],[153103247,150180229],[154494812,171650217],[160743517,173752949],[162822238,127558581],[173423993,161873907],[174994018,42381385],[175122640,27387904],[181062069,54947345],[181851546,76660232],[185499169,63232100],[186237392,178433669],[187936532,71027984],[189769903,20637955],[191697593,117914178],[193976661,128238567],[194759787,95982836],[197733881,81367228],[198406634,58050447],[198859231,192069713],[204337467,129713475],[205461833,95474873],[207560684,137762412],[208455722,124177451],[211358145,61230014],[212565967,128438408],[216479219,123346653],[217893909,13624358],[220099604,155928505],[223957091,102277113],[224546602,180721316],[226975504,54347914],[228296415,69850610],[228297342,183266131],[228620969,141929744],[231193671,6852325],[232861790,1378409],[235271530,102811153],[235866558,141190025],[239298003,29487475],[240885255,99134935],[242976956,118291340],[243876348,123401885],[251743992,51685713],[254782143,92586600],[256421527,98003260],[256545008,126493952],[258492584,102232724],[259312334,67441295],[260651980,164430621],[261883945,170902399],[263025125,85579372],[263298912,35952530],[267446046,174365927],[271176453,163579567],[273852300,26712550],[273991926,128326333],[277555111,78443630],[277708163,185587342],[280785809,128710485],[283341553,3172190],[283479228,198677521],[283516854,22426233],[284150181,42714011],[287029186,155766762],[288071036,185694757],[289082959,56206556],[289695843,11450100],[297768459,93514606],[299333727,157406189],[299875061,16380277],[301067092,23243115],[301258914,124923645],[301405908,123370143],[301559266,106305365],[303873757,94099878],[305105158,147062121],[305470147,107466812],[309466026,81504319],[309834813,112069028],[312286404,130176456],[312589505,194165492],[313979487,182206385],[316542310,146184307],[317779571,188583699],[319259141,149394969],[322421147,185855059],[323875987,56282109],[325505859,127949073],[325883649,193411448],[326331848,114815577],[328556970,4555740],[328951564,176821883],[329132420,114827530],[332927620,182522153],[333800585,169006810],[333847027,50943625],[335448539,96002198],[336253746,104171318],[338455004,166860084],[338871143,146253441],[338911351,615665],[341463479,67082282],[343571950,101700580],[345735107,157292108],[350052691,125103765],[352466441,165927139],[352530253,165201999],[353486999,172500899],[355371306,185617969],[356227432,26047722],[358111827,144509240],[360245969,107029822],[360572339,137264075],[364529878,50685065],[366497076,126776438],[369230527,52598745],[371127244,49097852],[371978048,57459214],[374695829,74774611],[378596359,113672140],[378760702,175204687],[384015359,157028184],[386135596,22794765],[387697827,118955318],[389777572,179538268],[391988595,150101413],[392913173,167766653],[394097189,155353290],[394375987,29054734],[398183916,190501],[398370870,22793072],[403260218,35319378],[403469738,195002757],[406802414,114261341],[410578343,86612369],[410685528,48280983],[413160465,175737970],[415357100,185415819],[416832665,87704571],[418511591,84554529],[425482983,9455474],[425585300,72332479],[431374876,120962615],[435379037,107771198],[439667326,157279736],[440423984,89536585],[442844623,114448899],[443380060,162808378],[447504850,43596488],[449003348,139858583],[449560754,166641114],[451084209,164822773],[453464748,111054232],[463012531,199178035],[467539489,34593218],[467820857,171945609],[471035259,133858929],[473203477,169330558],[476771470,150197483],[477689265,69129432],[481733714,140182676],[484337316,80144189],[486575917,169327081],[488918528,169171302],[488949564,91845849],[489638090,58345097],[494410980,57691176],[496374089,81282792],[497555207,190075499],[500405647,37631171],[502123455,138503612],[504216706,56005522],[505215575,134453958],[506544613,18865436],[507857985,37504562],[509303328,18532594],[514519167,137231763],[519285884,48634278],[519595068,57689543],[520346401,27193994],[520414937,16978345],[521967884,35031116],[527374969,35238451],[531809817,166528398],[532921613,99567685],[539633547,39051023],[540631734,183775868],[540779521,33944993],[543758238,110381835],[545130460,41502999],[545235801,172059449],[546235616,74393515],[546447873,166720969],[548327277,52117404],[556425075,158389277],[559569008,144727742],[563392736,51676668],[563449254,156858032],[563632797,133642234],[567889330,60153007],[568773626,95823330],[569924641,149397414],[572655226,31264789],[573147166,11476463],[575729054,64849554],[579696386,99711726],[579983881,141342708],[584598466,52345903],[588566518,149772762],[589280252,107595230],[591426824,110463071],[593750356,12194891],[594696432,145115542],[602125733,4609517],[602682743,195806695],[608525303,18751724],[608807594,127129267],[608878240,33316201],[609322203,123626112],[610121855,143861564],[611512819,132744092],[620539626,9193323],[622625372,734132],[623977234,127795962],[626034199,26525127],[627327394,118712712],[628095961,82846590],[639643661,68809870],[640039976,22886283],[640404958,189967392],[640634429,30081796],[641303857,148925304],[643038905,102427808],[651464745,99455614],[656790343,121720427],[658697455,2770895],[659129691,138187427],[659495385,159348987],[662014805,94658731],[663293429,144449528],[666318174,181974024],[666770808,29738601],[667259559,182262118],[668187231,178045355],[669855284,23847422],[670805078,44333515],[670956843,74635626],[673345330,60097570],[675743336,106089492],[676816431,153558492],[680063011,129610279],[680919791,155227228],[681506465,83596084],[682970395,40541143],[687187592,76696449],[691579069,49349680],[698137366,150496232],[699812253,61359975],[700558611,166238572],[701337728,190693183],[702889661,89462799],[702897284,49405873],[706166844,67707879],[706689175,49037228],[706863538,60641709],[707121416,149140178],[708288014,106964306],[710269870,185305805],[710393967,28903463],[710570062,133534811],[711920778,140760938],[716112897,20389577],[716701325,18179407],[717300251,185193795],[718442544,67199264],[718721586,158438367],[719242149,194038710],[720122334,73816916],[725313738,137403630],[730762507,40275789],[732070478,142384846],[732762045,49019851],[734433458,154224031],[734449502,174267955],[737339423,56358742],[737436887,177938666],[739015352,117872981],[744366033,185210151],[745125937,144643377],[746203971,67090918],[748860160,48789257],[752108061,152554175],[753371198,137936742],[753477636,76740350],[756075151,176525019],[763537658,34741618],[769182289,104214797],[770313567,49041647],[773898547,47830088],[774334548,81565669],[776071799,113267662],[781328054,182154303],[784840106,170920196],[788660941,57453767],[794349368,190183721],[795640416,27162207],[796951753,17900351],[798349780,78727115],[799796294,7097641],[801154779,190458284],[802796016,84210055],[807213302,164011367],[809706245,43864302],[809878906,195134230],[811088070,143282995],[813027950,184852803],[816375998,1481138],[816990809,84101835],[816996689,138041698],[817957237,66485476],[818240747,96607556],[824181805,155938592],[826276747,191758129],[826302264,183793508],[826600899,161320214],[828240895,132321067],[829320750,131831226],[832229512,18680629],[833291374,86944909],[833796914,163899729],[834412111,171528847],[834423388,184636184],[835104157,167937128],[835320952,127340601],[835884661,194205199],[839848768,87805982],[840542987,71172215],[840928498,91743737],[841053601,77487583],[847293043,49784332],[850694253,112298731],[851409852,172964917],[851684634,44020473],[852829637,53773260],[854907687,107414052],[855084116,105663637],[861080575,174402239],[863387060,180935149],[865812974,3668078],[865895316,47026710],[868056163,99928082],[869326386,107252746],[870600122,96448296],[875565667,37228530],[877047590,47708856],[878129865,124653232],[878148091,115119506],[878390630,188319677],[880674188,198005234],[881188688,87083808],[882992382,183858486],[883014037,169951672],[885914575,188645056],[886709601,192226088],[889521816,75956866],[893309534,193077283],[894007395,59396784],[894770778,160815121],[895794407,41554637],[895823000,60421722],[896118052,171994647],[896708632,2967281],[900417164,171040063],[901971898,145289103],[913230753,150200895],[913652496,154247093],[916987292,143825787],[917494304,124071070],[918913659,70612195],[920021444,9167734],[920043976,24204701],[921579512,53296996],[921809509,117848993],[928744671,136186420],[930084077,20290942],[930447086,180014873],[934202608,145180656],[937626474,141637310],[937661126,31421669],[938328679,23302553],[939181203,151087175],[940688040,1727863],[945349342,66978722],[946103921,110137972],[949316613,168656417],[949509158,53813996],[952239580,149479941],[954352433,37285537],[954830271,83408248],[956507792,86725092],[959871815,60111372],[960392253,170336421],[961387347,99592506],[963397245,2102417],[965066601,132618567],[966718326,14165742],[973570088,148893745],[977569683,161025399],[978811952,180090918],[981595688,4765406],[982894183,36629064],[983032557,147181407],[984866944,39526285],[985020277,94347816],[986624212,94360826],[987689069,28560397],[988265281,146313164],[989190622,106750569],[989462010,175207132],[992150040,152044867],[998126800,94323405]])